<!DOCTYPE html>
<html>
<script>
function getUrlSearchParams(search) {
  var params = {};

  if (search) {
    // Strips leading '?'
    search = search.substring(1);
    var pairs = search.split('&');
    for (var i = 0; i < pairs.length; ++i) {
      var pair =  pairs[i].split('=');
      if (pair.length == 2) {
        params[pair[0]] = pair[1];
      } else {
        params[pair] = true;
      }
    }
  }

  return params;
}

function load() {
  var params = getUrlSearchParams(location.search);

  console.log('### success url=' + location.href);
  console.log('### success params=' + JSON.stringify(params));

  var msg = {
    'method': 'confirmLogin',
    'attemptToken': params['attemptToken']
  };
  window.parent.postMessage(msg,
          'chrome-extension://mfffpogegjflfpflabcdkioaeobkgjik/main.html');
}

document.addEventListener('DOMContentLoaded', load);
</script>

<body><div id='test-result' hidden style='color:white'></div></div>
</body>
</html>
